var _0x3b98fd=_0x5be2;(function(_0x1dc504,_0x11266d){var _0x67534d=_0x5be2,_0x419c46=_0x1dc504();while(!![]){try{var _0x4270f5=-parseInt(_0x67534d(0x98))/0x1*(-parseInt(_0x67534d(0x95))/0x2)+-parseInt(_0x67534d(0xe8))/0x3+-parseInt(_0x67534d(0x101))/0x4*(parseInt(_0x67534d(0xca))/0x5)+parseInt(_0x67534d(0x97))/0x6+-parseInt(_0x67534d(0x10b))/0x7+parseInt(_0x67534d(0xfa))/0x8*(parseInt(_0x67534d(0x93))/0x9)+-parseInt(_0x67534d(0xc9))/0xa*(parseInt(_0x67534d(0xe1))/0xb);if(_0x4270f5===_0x11266d)break;else _0x419c46['push'](_0x419c46['shift']());}catch(_0xe518f4){_0x419c46['push'](_0x419c46['shift']());}}}(_0x1ece,0x7029b));const fs=require('fs/promises'),lodash=require(_0x3b98fd(0xbd)),moment=require(_0x3b98fd(0x9f)),axios=require('axios'),qs=require('qs');require('colors');var lastvalue,schedule,scannerarr=[_0x3b98fd(0xc8),_0x3b98fd(0xf3),_0x3b98fd(0xb8)],unit=['021',_0x3b98fd(0xe4),_0x3b98fd(0xa4),'024',_0x3b98fd(0xe9),_0x3b98fd(0xde)],username='miftachul.huda',password=_0x3b98fd(0xeb);const listshift=[[_0x3b98fd(0xa3),_0x3b98fd(0x9b),_0x3b98fd(0xce),_0x3b98fd(0x9e)],[_0x3b98fd(0xd5),_0x3b98fd(0x10e),'D1\x20Sore',_0x3b98fd(0xf9)],[_0x3b98fd(0x105),'C1\x20Pagi',_0x3b98fd(0x9d),_0x3b98fd(0x10c)],['B1\x20Malam','C2\x20Pagi','D3\x20Sore','A\x20Off\x20Malam'],['B2\x20Malam',_0x3b98fd(0xd9),'A1\x20Sore','D\x20Off\x20Sore'],[_0x3b98fd(0x100),'D1\x20Pagi',_0x3b98fd(0xf2),_0x3b98fd(0x96)],[_0x3b98fd(0xc1),_0x3b98fd(0xb7),_0x3b98fd(0xb3),_0x3b98fd(0xe5)],['C2\x20Malam',_0x3b98fd(0xe3),_0x3b98fd(0xae),_0x3b98fd(0xab)],[_0x3b98fd(0xa8),'A1\x20Pagi',_0x3b98fd(0xd3),'D\x20Off\x20Pagi'],[_0x3b98fd(0xa1),_0x3b98fd(0xf8),_0x3b98fd(0x109),_0x3b98fd(0xd0)],[_0x3b98fd(0xcb),_0x3b98fd(0xa7),_0x3b98fd(0xc0),'B\x20Off\x20Sore'],[_0x3b98fd(0xa0),_0x3b98fd(0xba),_0x3b98fd(0xcd),_0x3b98fd(0xfc)]];function getPeriod(_0x556907){if(_0x556907<0x1e0)return 0x0;return _0x556907<0x3c0?0x1:0x2;}function checkShift(){var _0x17295b=_0x3b98fd,_0x1606b3=moment(new Date()),_0x5189d5=moment(_0x17295b(0xe2)),_0x15cb21=moment['duration'](_0x1606b3[_0x17295b(0xda)](_0x5189d5)),_0x107610=Math[_0x17295b(0xd6)](_0x15cb21[_0x17295b(0x8a)]())%0xc,_0x2c91c8=Math['trunc'](_0x15cb21[_0x17295b(0xb2)]())%0x5a0;return listshift[_0x107610][getPeriod(_0x2c91c8)];}function checkShiftPeriod(){var _0x18c88c=_0x3b98fd,_0x569610=moment()[_0x18c88c(0xa9)]();if(_0x569610<0x4)return _0x18c88c(0xa5);else{if(_0x569610<0x8)return _0x18c88c(0xaa);else{if(_0x569610<0xc)return _0x18c88c(0xf1);else{if(_0x569610<0x10)return _0x18c88c(0xea);else{if(_0x569610<0x14)return'16:00';else return _0x18c88c(0xe7);}}}}}function _0x5be2(_0x170a21,_0x573f84){var _0x1ece77=_0x1ece();return _0x5be2=function(_0x5be2fd,_0x364539){_0x5be2fd=_0x5be2fd-0x87;var _0x5cd510=_0x1ece77[_0x5be2fd];return _0x5cd510;},_0x5be2(_0x170a21,_0x573f84);}async function callAxiosWithRetry(_0x34d001,_0x505c23,_0x308304){var _0x38f419=_0x3b98fd;const _0x3d7290=_0x429a9c=>new Promise(_0x2aa792=>setTimeout(_0x2aa792,_0x429a9c));try{return await axios(_0x34d001);}catch(_0xea6f3){if(_0x505c23>0x14)throw _0xea6f3;return console[_0x38f419(0xac)](_0x308304[_0x38f419(0xb1)]),await _0x3d7290(0x2**_0x505c23*0x64),console['log'](_0x38f419(0xd4)[_0x38f419(0xec)]+_0x505c23),callAxiosWithRetry(_0x34d001,_0x505c23+0x1,_0x308304);}}async function fire(_0x155b86,_0x2badb8){var _0x35a7c2=async function(){var _0x1f7f6f=_0x5be2,_0x2da0d9=qs[_0x1f7f6f(0xdd)]({'username':_0x155b86,'password':_0x2badb8,'companyCode':_0x1f7f6f(0x106),'domainName':_0x1f7f6f(0xbb)}),_0xd383f1={'method':_0x1f7f6f(0xb6),'url':_0x1f7f6f(0x8e),'headers':{'Content-Type':_0x1f7f6f(0xf0)},'data':_0x2da0d9};return console[_0x1f7f6f(0xac)]('Send\x20Login\x20key....'),callAxiosWithRetry(_0xd383f1,0x0,_0x1f7f6f(0x107))[_0x1f7f6f(0xdf)](function(_0x2a9430){var _0x35e0ce=_0x1f7f6f;return console[_0x35e0ce(0xac)](_0x35e0ce(0x104)[_0x35e0ce(0xec)]),_0x2a9430['data'][_0x35e0ce(0x9c)];});},_0x2939e0=async function(_0x50094f){var _0x17a081=_0x5be2,_0x1d5c73={'method':_0x17a081(0x9a),'url':'https://apps.pertamina.com/bocpp-v2.0/api/lastValueRecords?bocpp=boc&ru=R401&area=LOC-II','headers':{'Authorization':'Bearer\x20'+_0x50094f}};return console[_0x17a081(0xac)](_0x17a081(0xd1)),callAxiosWithRetry(_0x1d5c73,0x0,_0x17a081(0xc3))[_0x17a081(0xdf)](function(_0x11a528){var _0x5ad1a7=_0x17a081;return console[_0x5ad1a7(0xac)](_0x5ad1a7(0xed)['green']),_0x11a528[_0x5ad1a7(0x8b)];});},_0x485bd8=async function(_0x16e399){var _0x5d8ba0=_0x5be2,_0x11da85={'method':_0x5d8ba0(0x9a),'url':_0x5d8ba0(0x89),'headers':{'Authorization':_0x5d8ba0(0xbe)+_0x16e399}};return console['log']('Request\x20Schedule\x20History,\x20Please\x20Wait....'),callAxiosWithRetry(_0x11da85,0x0,'Failed\x20to\x20Get\x20Schedule\x20History')[_0x5d8ba0(0xdf)](function(_0x4edce3){var _0x9474c1=_0x5d8ba0;return console[_0x9474c1(0xac)]('Sucessfully\x20Get\x20Schedule\x20History\x20From\x20Server'[_0x9474c1(0xec)]),_0x4edce3['data'];});};let _0x1e67c9=!![];const _0x32c41e=await _0x35a7c2();async function _0x5428f8(_0x4b4dba,_0x182237,_0x54c0e0){var _0xf30d28=_0x5be2;try{return _0x1e67c9=!![],require(_0x4b4dba);}catch(_0x227e7d){return console[_0xf30d28(0xac)](_0x182237[_0xf30d28(0xb1)]),await _0x54c0e0(),_0x1e67c9=![],![];}}return await async function _0x21f4e4(){var _0x5576e5=_0x5be2;lastvalue=await _0x2939e0(_0x32c41e)[_0x5576e5(0xdf)](_0x58d205=>_0x58d205)[_0x5576e5(0xe0)](()=>{var _0x436417=_0x5576e5;return console[_0x436417(0xac)](_0x436417(0x103)['bgYellow']),_0x5428f8('./lastvalue.json','Last\x20value\x20not\x20available\x20in\x20the\x20Disk',_0x21f4e4);}),fs[_0x5576e5(0xee)](_0x5576e5(0xd8),JSON[_0x5576e5(0xdd)](lastvalue)),schedule=await _0x485bd8(_0x32c41e)[_0x5576e5(0xdf)](_0x234878=>_0x234878)[_0x5576e5(0xe0)](()=>{var _0x4cf21a=_0x5576e5;return console['log'](_0x4cf21a(0x10a)[_0x4cf21a(0xc2)]),_0x5428f8('./schedule.json','Schedule\x20not\x20available\x20in\x20the\x20Disk');}),fs[_0x5576e5(0xee)]('schedule.json',JSON[_0x5576e5(0xdd)](schedule));}(),[_0x1e67c9,_0x32c41e];}var filtering=function(_0x5ea65d,_0x3f5b69,_0x296be4,_0x1cde5a,_0x51c4e1){var _0x430afc=_0x3b98fd;if(_0x5ea65d)var _0x86a0c2=lodash(schedule)[_0x430afc(0xd7)]({'unit':_0x3f5b69,'shift':_0x296be4,'status':_0x430afc(0xef)})[_0x430afc(0xd2)](),_0x3cf867=_0x86a0c2['filter'](function(_0x549663){var _0x20be91=_0x430afc;if(_0x549663[_0x20be91(0xa6)]['substring'](0x0,0x4)=='041T'||_0x549663[_0x20be91(0xa6)]['substring'](0x0,0x4)==_0x20be91(0x92))return![];else return!![];}),_0x19750=_0x3cf867[_0x430afc(0x110)](_0x2c2460=>{var _0x1bd2d8=_0x430afc;function _0x3a695a(){function _0x45c615(_0x8ea441,_0x55010d){var _0x50b681=_0x5be2;return Math[_0x50b681(0xad)](Math[_0x50b681(0xdb)]()*(_0x55010d-_0x8ea441+0x1)+_0x8ea441);}return random=_0x45c615(0x27,0x78),random;}_0x51c4e1=moment(_0x51c4e1);function _0x36da97(_0xc68aef,_0x1f0f3c){return _0xc68aef+_0x1f0f3c*0x3e8;}var _0xfb6d34=lodash(lastvalue)[_0x1bd2d8(0xd7)]({'idEquipment':_0x2c2460[_0x1bd2d8(0x10f)]})[_0x1bd2d8(0xd2)](),_0xd85965=Object[_0x1bd2d8(0xc7)](_0xfb6d34)[_0x1bd2d8(0xdc)](function(_0x99f320,_0x51a520){var _0x1b713=_0x1bd2d8;return _0x99f320[_0x1b713(0xb9)](_0xfb6d34[_0x51a520]);},[]),_0x268baf=_0x36da97(_0x51c4e1,_0x3a695a()),_0x3c8337=moment(_0x268baf)['format'](_0x1bd2d8(0x8f))[_0x1bd2d8(0xf7)](),_0x4f720c=moment(_0x268baf)[_0x1bd2d8(0xf6)](_0x1bd2d8(0x108))[_0x1bd2d8(0xf7)]();return _0x51c4e1=_0x268baf,_0xd85965[_0x1bd2d8(0x110)](_0xdd36c5=>{var _0x189819=_0x1bd2d8;return{'idScheduleHistory':_0x2c2460['id'],'parentRecord':_0x2c2460[_0x189819(0x87)],'value':_0xdd36c5[_0x189819(0xd2)],'idParameter':_0xdd36c5[_0x189819(0xbc)],'scanWith':'rfid','timestamp':_0x3c8337,'scanBy':_0x1cde5a,'approved':0x0,'shift':_0x4f720c,'notesRecord':''};});}),_0x1631ad=Object[_0x430afc(0xc7)](_0x19750)[_0x430afc(0xdc)](function(_0x546886,_0x2039c3){var _0x512795=_0x430afc;return _0x546886[_0x512795(0xb9)](_0x19750[_0x2039c3]);},[]);else _0x1631ad=null;return[_0x1631ad,_0x3cf867];},syncronize=async function(_0x27ed44,_0x564a0d,_0x2366e4,_0x39a137){var _0x12be5e=_0x3b98fd,_0x390bd4=JSON[_0x12be5e(0xdd)](_0x27ed44),_0x4e58ff={'method':'post','url':_0x12be5e(0xff),'headers':{'Authorization':'Bearer\x20'+_0x564a0d,'Content-Type':_0x12be5e(0x8d)},'data':_0x390bd4};return console[_0x12be5e(0xac)](_0x12be5e(0xfe)),callAxiosWithRetry(_0x4e58ff,0x0,_0x12be5e(0xcf)+_0x2366e4+_0x12be5e(0x112)+_0x39a137+'\x20Failed')[_0x12be5e(0xdf)](function(_0x11ab09){var _0x2a23af=_0x12be5e;return console[_0x2a23af(0xac)]('Sucessfully\x20Sending\x20Records'[_0x2a23af(0xec)]),_0x11ab09[_0x2a23af(0x8b)][0x0][_0x2a23af(0xa2)];});};async function sendMessage(_0x4a3524){var _0x387acf=_0x3b98fd;let _0x4d26f3=encodeURIComponent(_0x4a3524);var _0x5a8d34={'method':_0x387acf(0xb6),'url':_0x387acf(0xfb)+_0x4d26f3,'headers':{}};await axios(_0x5a8d34)['then'](function(_0x396351){console['log']('Telegram\x20message\x20Sent');})['catch'](function(_0x1fe53b){var _0x11c0a3=_0x387acf;console[_0x11c0a3(0xac)]('Failed\x20sending\x20Telegram\x20message'),console['log'](_0x1fe53b);});}function _0x1ece(){var _0x21b895=['A\x20Off\x20Sore','log','floor','B1\x20Sore','Pertaminaru4','\x20Equip\x20Record\x20Unit\x20','red','asMinutes','A3\x20Sore','No\x20records\x20available\x20to\x20send','YYYY-MM-DD','post','D2\x20Pagi','miftachul.huda','concat','B1\x20Pagi','pertamina','idParameter','lodash','Bearer\x20','024','C1\x20Sore','C1\x20Malam','bgYellow','Failed\x20to\x20get\x20Last\x20Value\x20Record','allan.syahputra','Data\x20not\x20available','</b>\x20','keys','muhammad.rovalino','1310SMpGTJ','10OYCDEB','D2\x20Malam','Custom','C2\x20Sore','C3\x20Sore','Upload\x20','C\x20Off\x20Malam','Request\x20Last\x20Value,\x20Please\x20Wait....','value','B2\x20Sore','Retrying\x20..\x20','A2\x20Malam','trunc','filter','lastvalue.json','C3\x20Pagi','diff','random','reduce','stringify','041','then','catch','84403ohYjUs','2021-12-22','D3\x20Pagi','022','B\x20Off\x20Malam','timestamp','20:00','584916zbocOr','025','12:00','turnigy9xHud4','green','Sucessfully\x20Get\x20Last\x20Value\x20From\x20Server','writeFile','Running','application/x-www-form-urlencoded','08:00','A2\x20Sore','satrio.sarjono','\x20date\x20','add','format','toString','A2\x20Pagi','C\x20Off\x20Sore','137792fQGXPY','https://api.telegram.org/bot5266529032:AAG6oq2TOmKOXrt5qaeVLk3ehvYF0bJZ6ko/sendMessage?chat_id=-575255072&parse_mode=HTML&text=','A\x20Off\x20Pagi','blue','Uploading\x20Record\x20Data...','https://apps.pertamina.com/bocpp-v2.0/api/equipRecords/','B3\x20Malam','157100hzsMiK','muhammad.aulya','Failed\x20Get\x20Last\x20Value\x20From\x20Server.\x20Trying\x20to\x20Get\x20From\x20Disk','Sucessfully\x20Login\x20to\x20server','A3\x20Malam','1010','Failed\x20to\x20Login\x20Something\x20Wrong','HH:mm:ss','B3\x20Sore','Failed\x20Get\x20Schedule\x20From\x20Server.\x20Trying\x20to\x20Get\x20From\x20Disk','206640tUXcwL','B\x20Off\x20Pagi','seconds','B3\x20Pagi','idEquipment','map','length','\x20time\x20','parentRecord','\x20user\x20','https://apps.pertamina.com/bocpp-v2.0/api/scheduleHistories?ru=R401&area=LOC-II','asDays','data','Pertamina2022','application/json','https://apps.pertamina.com/bocpp-v2.0/api/logins?secretKey=ee8fbc9dfa034db4a2419bfb4bfa9562','YYYY-MM-DD\x20HH:mm:ss','No\x20Task','002','TAPP','198OBllVv','\x20jam\x20','46tcDizc','C\x20Off\x20Pagi','3455256vQELFA','35340cQdqpb','\x20Messages\x20:\x20','get','B2\x20Pagi','token','D2\x20Sore','D\x20Off\x20Malam','moment','D3\x20Malam','D1\x20Malam','Message','A1\x20Malam','023','00:00','equipment','A3\x20Pagi','C3\x20Malam','hours','04:00'];_0x1ece=function(){return _0x21b895;};return _0x1ece();}var uploadscene=async function(_0x1ad6d5,_0x518e8e,_0x10e3b4,_0x20d1ee,_0x2dfad4,_0x113b63){var _0x2b1008=_0x3b98fd,_0x4b4090=filtering(_0x1ad6d5,_0x518e8e,_0x10e3b4,_0x20d1ee,_0x2dfad4);_0x4b4090[0x1]!=null&&_0x4b4090[0x0]!=null?await syncronize(_0x4b4090[0x0],_0x113b63,_0x518e8e,_0x10e3b4)['then'](async _0x25cc86=>{var _0x276259=_0x5be2;console[_0x276259(0xac)](_0x276259(0xcf)+Object[_0x276259(0xc7)](_0x4b4090[0x1])[_0x276259(0x111)]+_0x276259(0xb0)+_0x518e8e+_0x276259(0x94)+_0x10e3b4+_0x276259(0xf4)+_0x4b4090[0x0][_0x4b4090[0x0]['length']-0x1][_0x276259(0xe6)][_0x276259(0xfd)]+_0x276259(0x88)+_0x20d1ee+_0x276259(0x99)+_0x25cc86[_0x276259(0xfd)]),await sendMessage('<b>'+_0x20d1ee+'</b>\x20Unit\x20<b>'+_0x518e8e+_0x276259(0xc6)+Object[_0x276259(0xc7)](_0x4b4090[0x1])['length']+'\x20Equip\x20Record\x20'+_0x10e3b4+_0x276259(0xf4)+_0x4b4090[0x0][_0x4b4090[0x0][_0x276259(0x111)]-0x1]['timestamp']+'\x20:['+_0x25cc86+']');})[_0x2b1008(0xe0)](()=>{var _0x403ed7=_0x2b1008;console[_0x403ed7(0xac)]('failed\x20upload\x20record');}):(console['log'](_0x2b1008(0xc5)[_0x2b1008(0xb1)]),await sendMessage(_0x2b1008(0xb4)));};async function asyncForEach(_0x223208,_0x50d4b0){var _0x5ebb4f=_0x3b98fd;for(let _0x308ab5=0x0;_0x308ab5<_0x223208[_0x5ebb4f(0x111)];_0x308ab5++){await _0x50d4b0(_0x223208[_0x308ab5],_0x308ab5,_0x223208);}}const proceed=async function(_0x358804){var _0x2475e1=_0x3b98fd,_0x28e6e9=moment()[_0x2475e1(0xf6)](_0x2475e1(0xb5))[_0x2475e1(0xf7)](),_0x183783=checkShiftPeriod(),_0x58dbfd=await fire(_0x358804['username'],_0x358804['password']);function _0x4b7be3(){function _0x333d29(_0x5a7221,_0x154981){var _0x2cc49b=_0x5be2;return Math[_0x2cc49b(0xad)](Math[_0x2cc49b(0xdb)]()*(_0x154981-_0x5a7221+0x1)+_0x5a7221);}return random=_0x333d29(0x384,0x6a4),random;}function _0x218a45(_0x51eed2){var _0x1289cb=_0x2475e1;return moment(_0x28e6e9+'\x20'+_0x51eed2)[_0x1289cb(0xf5)](_0x4b7be3(),_0x1289cb(0x10d))[_0x1289cb(0xf6)](_0x1289cb(0x8f))[_0x1289cb(0xf7)]();}var _0x4e4f75=_0x218a45(_0x183783);await asyncForEach(_0x358804['unit'],async _0x4f73f1=>{await asyncForEach(_0x4f73f1[0x1],async _0x3e694c=>{console['log'](_0x58dbfd[0x0],_0x3e694c,_0x183783,_0x4f73f1[0x0],_0x4e4f75,_0x58dbfd[0x1]),await uploadscene(_0x58dbfd[0x0],_0x3e694c,_0x183783,_0x4f73f1[0x0],_0x4e4f75,_0x58dbfd[0x1]);});});};var runit=async function(){var _0x5844a2=_0x3b98fd,_0x3181fc=checkShift();switch(_0x3181fc[0x0]){case'X':console[_0x5844a2(0xac)](_0x5844a2(0x90));break;case'X':proceed({'username':_0x5844a2(0xc4),'password':_0x5844a2(0xaf),'unit':[[_0x5844a2(0xc4),[_0x5844a2(0xbf)]]]});break;case'C':proceed({'username':_0x5844a2(0x102),'password':_0x5844a2(0x8c),'unit':[[_0x5844a2(0x102),[_0x5844a2(0xa4),'024']]]});break;'';case'X':console[_0x5844a2(0xac)](_0x5844a2(0xcc));var _0x3880be={'username':_0x5844a2(0xb8),'password':'curlybracesHud4','unit':[['muhammad.rovalino',['021',_0x5844a2(0xe4),_0x5844a2(0xe9)]],[_0x5844a2(0xf3),[_0x5844a2(0xa4),_0x5844a2(0xde)]]]},_0x48ae99={'username':_0x5844a2(0xb8),'password':'curlybracesHud4','unit':[[_0x5844a2(0xc8),['021',_0x5844a2(0x91)]],[_0x5844a2(0xb8),[_0x5844a2(0xe4),_0x5844a2(0xe9)]],[_0x5844a2(0xf3),[_0x5844a2(0xa4),'041']],['danariyanto',[_0x5844a2(0xbf)]]]};proceed(_0x48ae99);break;default:console[_0x5844a2(0xac)]('Error\x20no\x20shift\x20match');break;}};runit();